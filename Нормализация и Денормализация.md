 tags: [data-engineering, database, data-modeling, sql, nosql, interviewprep]  
alias: [Нормализация, Денормализация, Нормальные формы]  
related: [[OLTP vs. OLAP]], [[Data Modeling (Dimensional, etc.)]], [[SQL]], [[NoSQL Concepts and CAP Theorem]]

Нормализация и денормализация — это два противоположных подхода к организации данных в базе данных. Выбор между ними — это **фундаментальный компромисс** между **целостностью данных** и **производительностью чтения**.

---

## [[Нормализация (Normalization)]]

**Идея**: Процесс организации данных в реляционной базе данных с целью **минимизации избыточности (дублирования) данных**. Это достигается путем разделения больших таблиц на более мелкие, хорошо структурированные таблицы и определения связей между ними.

**Главная цель**: Устранить аномалии данных (проблемы при вставке, обновлении и удалении) и обеспечить целостность.

**Пример:**  
Предположим, у нас есть одна таблица для книг и авторов.  
**Плохо (не нормализовано):**  
| book_id | title | author_name | author_email |  
|---------|---------------------|--------------|-------------------|  
| 1 | Война и мир | Лев Толстой | [leo@example.com](https://www.google.com/url?sa=E&q=mailto%3Aleo%40example.com) |  
| 2 | Анна Каренина | Лев Толстой | [leo@example.com](https://www.google.com/url?sa=E&q=mailto%3Aleo%40example.com) |  
| 3 | Преступление и нак. | Ф. Достоевский| [fmd@example.com](https://www.google.com/url?sa=E&q=mailto%3Afmd%40example.com) |

- **Проблема**: Информация о Льве Толстом дублируется. Если его email изменится, нам придется обновить его в **нескольких** строках, и есть риск сделать это не везде (это называется **аномалия обновления**).
    

**Хорошо (нормализовано):**  
Таблица Authors:  
| author_id | author_name | author_email |  
|-----------|--------------|-----------------|  
| 101 | Лев Толстой | [leo@example.com](https://www.google.com/url?sa=E&q=mailto%3Aleo%40example.com) |  
| 102 | Ф. Достоевский| [fmd@example.com](https://www.google.com/url?sa=E&q=mailto%3Afmd%40example.com) |

Таблица Books:  
| book_id | title | author_id_fk |  
|---------|---------------------|--------------|  
| 1 | Война и мир | 101 |  
| 2 | Анна Каренина | 101 |  
| 3 | Преступление и нак. | 102 |

### Нормальные формы

Процесс нормализации следует набору правил, называемых **нормальными формами (NF)**. Для большинства практических целей достаточно знать о первых трех:

- **1NF**: Все значения в ячейках атомарны (неделимы), нет повторяющихся групп.
    
- **2NF**: Таблица находится в 1NF, и все неключевые столбцы полностью зависят от всего первичного ключа.
    
- **3NF**: Таблица находится в 2NF, и нет транзитивных зависимостей (неключевые поля не зависят от других неключевых полей).  
    Для [[OLTP]] систем стандартной целью является **третья нормальная форма (3NF)**.
    

**(+) Плюсы:**

- **Высокая целостность данных**: Отсутствие дублирования.
    
- **Экономия места на диске**: Каждая часть информации хранится только один раз.
    
- **Быстрые операции записи**: INSERT, UPDATE, DELETE затрагивают только одну таблицу.
    

**(-) Минусы:**

- **Медленные операции чтения**: Для получения полной картины часто требуются сложные [[JOINs|JOIN'ы]] между множеством таблиц.
    

---

## [[Денормализация (Denormalization)]]

**Идея**: Процесс **намеренного** добавления избыточных данных в таблицу для оптимизации производительности чтения.

**Главная цель**: Уменьшить количество JOIN'ов и, как следствие, ускорить выполнение SELECT запросов.

**Пример:**  
Для аналитического запроса нам нужно часто видеть имя автора рядом с названием книги. Чтобы не делать JOIN каждый раз, мы можем создать денормализованную таблицу:  
| book_id | title | author_name |  
|---------|---------------------|--------------|  
| 1 | Война и мир | Лев Толстой |  
| 2 | Анна Каренина | Лев Толстой |  
| 3 | Преступление и нак. | Ф. Достоевский|

Теперь, чтобы получить эту информацию, нужен простой SELECT * FROM denormalized_books; без JOIN'ов.

**(+) Плюсы:**

- **Очень быстрые операции чтения**: Часто не требуют JOIN'ов.
    
- **Упрощение запросов**: Запросы становятся короче и понятнее.
    

**(-) Минусы:**

- **Избыточность данных**: Требуется больше места для хранения.
    
- **Потенциальные проблемы с целостностью**: Требуются более сложные и медленные операции записи для поддержания данных в согласованном состоянии.
    
- **Риск аномалий обновления**: Нужно обновлять данные в нескольких местах.
    

---

### Контекст решает всё: OLTP vs. OLAP

|   |   |   |
|---|---|---|
|Система|Подход|Почему?|
|**[[OLTP]] (транзакционные системы)**|**Нормализация**|Критически важна целостность данных и скорость записи. Множество мелких UPDATE/INSERT.|
|**[[OLAP]] (аналитические системы)**|**Денормализация**|Критически важна скорость выполнения сложных запросов на чтение. JOIN'ы — это дорого.|
|**`[[NoSQL Concepts and CAP Theorem|NoSQL]]` базы данных**|**Денормализация**|

---

### Популярные вопросы на собеседовании

- **"Что такое нормализация и какова ее главная цель?"**
    
- **"Объясните компромисс между нормализацией и денормализацией."**
    
    - Ответ: Это компромисс между целостностью данных и скоростью записи (нормализация) с одной стороны, и скоростью чтения и простотой запросов (денормализация) с другой.
        
- **"Приведите пример, когда вы бы использовали нормализованную схему, а когда — денормализованную."**
    
    - Ответ: Нормализованную — для базы данных интернет-магазина, где обрабатываются заказы. Денормализованную — для витрины данных в [[Data Warehousing|хранилище]], которая используется для построения BI-дашборда.
        
- **"Что такое 'аномалия обновления' и какой подход помогает ее избежать?"**
    
    - Ответ: Это ситуация, когда для изменения одного и того же факта требуется обновить несколько записей, что создает риск несоответствия данных. Нормализация помогает этого избежать, так как каждый факт хранится только в одном месте.