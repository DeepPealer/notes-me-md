tags: [data-engineering, database, data-modeling, sql, normalization, interviewprep]  
alias: [3NF, Третья нормальная форма]  
related: [[Нормализация и Денормализация]], [[OLAP vs OLTP]], [[SQL]]

Третья нормальная форма (3NF) — это ключевой стандарт в нормализации реляционных баз данных, который направлен на дальнейшее уменьшение избыточности данных путем устранения **транзитивных зависимостей**.

**Простое правило 3NF**: Все столбцы в таблице должны зависеть **только от первичного ключа**, а не от других неключевых столбцов.

> **Классическая мнемоника**: "Каждый неключевой атрибут должен предоставлять факт о ключе, целом ключе (это про 2NF) и ни о чём, кроме ключа (это про 3NF)".

---

### Условия для 3NF

Чтобы таблица находилась в 3NF, она должна соответствовать двум условиям:

1. Она уже находится во **второй нормальной форме (2NF)**. (Напомним, 2NF требует, чтобы все неключевые поля зависели от всего составного первичного ключа, а не от его части).
    
2. В ней **отсутствуют транзитивные зависимости**.
    

---

### Что такое транзитивная зависимость?

Это и есть ядро 3NF. **Транзитивная зависимость** возникает, когда неключевой столбец C зависит от другого неключевого столбца B, который, в свою очередь, зависит от первичного ключа A.

Схематично это выглядит так: A -> B -> C.

**Пример:**  
Предположим, у нас есть таблица турниров по теннису.  
**Плохо (нарушение 3NF):**  
| tournament_id (PK) | tournament_name | winner_name | winner_birthdate |  
|--------------------|-----------------|--------------|------------------|  
| 1 | Wimbledon 2023 | Alcaraz | 2003-05-05 |  
| 2 | US Open 2023 | Djokovic | 1987-05-22 |  
| 3 | Wimbledon 2022 | Djokovic | 1987-05-22 |

Здесь:

- winner_name зависит от tournament_id (ключ).
    
- winner_birthdate зависит от winner_name (неключевое поле).
    
- Следовательно, winner_birthdate **транзитивно** зависит от tournament_id.
    

**Проблемы (аномалии):**

1. **Аномалия обновления**: Если мы узнаем, что у Джоковича неправильная дата рождения, нам придется обновить её в **нескольких строках**.
    
2. **Аномалия вставки**: Мы не можем добавить информацию о новом игроке и его дате рождения, пока он не выиграет какой-нибудь турнир.
    
3. **Аномалия удаления**: Если мы удалим все турниры, выигранные Алькарасом, мы потеряем информацию о его дате рождения.
    

---

### Приведение к 3NF

Чтобы исправить нарушение, мы должны вынести транзитивную зависимость в отдельную таблицу.

**Хорошо (в 3NF):**  
Таблица Tournaments:  
| tournament_id (PK) | tournament_name | winner_id_fk |  
|--------------------|-----------------|--------------|  
| 1 | Wimbledon 2023 | 101 |  
| 2 | US Open 2023 | 102 |  
| 3 | Wimbledon 2022 | 102 |

Таблица Winners:  
| winner_id (PK) | winner_name | winner_birthdate |  
|----------------|--------------|------------------|  
| 101 | Alcaraz | 2003-05-05 |  
| 102 | Djokovic | 1987-05-22 |

**Результат:**

- Теперь каждая таблица описывает одну сущность: "Турниры" и "Победители".
    
- Информация о дате рождения каждого победителя хранится только в одном месте.
    
- Все аномалии устранены. Для обновления даты рождения Джоковича нужна всего одна операция в таблице Winners.
    

---

### Когда важна 3NF?

Соблюдение 3NF является **золотым стандартом** для проектирования [[OLTP vs OLTP|OLTP]]-систем (транзакционных баз данных).

- **Причина**: В OLTP-системах происходит множество операций записи (INSERT, UPDATE, DELETE). Отсутствие избыточности, которое гарантирует 3NF, делает эти операции быстрыми, надежными и защищает целостность данных.
    

В [[OLAP vs OLTP|OLAP]]-системах (хранилищах данных) этим правилом часто **намеренно пренебрегают** в пользу [[Нормализация и Денормализация|денормализации]], чтобы ускорить чтение данных и избежать сложных JOIN'ов.

---

### Популярные вопросы на собеседовании

- **"Что такое третья нормальная форма?"**
    
- **"Объясните, что такое транзитивная зависимость, и приведите пример."**
    
- **"Почему 3NF так важна для OLTP баз данных?"**
    
    - Ответ: Потому что она минимизирует избыточность данных, что предотвращает аномалии при частых операциях записи и обеспечивает высокую целостность данных.
        
- **"Как вы исправите нарушение 3NF в таблице?"**
    
    - Ответ: Я бы выделил столбец (или группу столбцов), который транзитивно зависит от ключа, в отдельную таблицу, связав ее с исходной через внешний ключ.
        

---