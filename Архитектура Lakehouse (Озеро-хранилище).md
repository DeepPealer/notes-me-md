tags: [data-engineering, lakehouse, databricks, bigdata, data-architecture, delta-lake, interviewprep]  
alias: [Lakehouse, Озеро-хранилище, Архитектура Lakehouse]  
related: [[Data Warehousing (DWH), Inmon vs Kimball Methodologies]], [[Data Lakes]], [[ETL / ELT Concepts]], [[Apache Spark]]

**Lakehouse** — это современная архитектура управления данными, которая объединяет лучшие черты [[Data Lakes|Озер данных]] и [[Data Warehousing (DWH)|Хранилищ данных]] в единой системе.

> **Основная идея**: Взять дешевое, гибкое и масштабируемое хранилище от Озера данных и добавить поверх него возможности управления, надежности и производительности от Хранилища данных.

**Аналогия**:

- **Data Lake**: Природное озеро с сырой водой.
    
- **Data Warehouse**: Магазин с дорогой, очищенной бутилированной водой.
    
- **Lakehouse**: Природное озеро, на берегу которого построен **высокотехнологичный завод по очистке и розливу воды**. Вы получаете и доступ к сырой воде, и готовый продукт из одного и того же места.
    

### Проблема, которую решает Lakehouse

Традиционный подход часто требовал двух систем:

1. **Озеро данных** для сбора всех сырых данных, используемых для Data Science и ML.
    
2. **Хранилище данных**, куда по [[ETL / ELT Concepts|ETL]]-процессу копировалась часть данных для BI и аналитики.
    

Это создавало проблемы:

- **Избыточность**: Данные хранились в двух местах.
    
- **Сложность и задержки**: ETL-процессы между озером и хранилищем были сложными и вносили задержку.
    
- **Рассинхронизация**: Данные в хранилище могли устаревать.
    

Lakehouse предлагает **единую систему** для всех этих задач.

---

### Ключевые компоненты архитектуры Lakehouse

1. **Открытое хранилище (Open Storage)**
    
    - В основе лежит дешевое объектное хранилище, как в обычном озере: **Amazon S3, Google Cloud Storage, Azure Data Lake Storage**.
        
    - Данные хранятся в **открытых форматах** (например, **Apache Parquet**), что предотвращает "привязку" к одному вендору.
        
2. **Транзакционный слой (Transactional Layer)** — **ЭТО СЕРДЦЕ LAKEHOUSE**
    
    - Это слой метаданных поверх файлов в озере, который добавляет критически важную функциональность баз данных.
        
    - **Ключевые технологии**: **Delta Lake** (продвигается Databricks), **Apache Iceberg**, **Apache Hudi**.
        
    - **Что он дает?**
        
        - **ACID-транзакции**: Гарантирует, что операции записи либо полностью успешны, либо полностью отменены. Можно безопасно выполнять INSERT, UPDATE, DELETE прямо над файлами в озере.
            
        - **Управление версиями и Time Travel**: Возможность просматривать состояние таблицы на любой момент времени в прошлом или откатывать изменения.
            
        - **Контроль схемы (Schema Enforcement & Evolution)**: Предотвращает запись "грязных" данных и позволяет плавно изменять структуру таблиц.
            
3. **Вычислительный движок (Processing Engine)**
    
    - Для обработки данных используется один или несколько распределенных движков.
        
    - Основной движок для Lakehouse — это [[MapReduce and Massively Parallel Processing (MPP)|Apache Spark]].
        
    - Также могут использоваться другие, например, Trino (Presto).
        

---

### Medallion Architecture (Медальонная архитектура)

Это популярный паттерн организации данных внутри Lakehouse, который предлагает структурировать данные в три слоя:

- **Bronze (Бронзовый слой)**
    
    - **Что это?** Сырые данные, загруженные из источников "как есть". Это ваша "историческая" копия, к которой всегда можно вернуться.
        
    - **Соответствует**: Staging area.
        
- **Silver (Серебряный слой)**
    
    - **Что это?** Очищенная, отфильтрованная, дополненная и объединенная версия данных из бронзового слоя.
        
    - **Примеры операций**: приведение типов, обработка NULL, объединение с другими таблицами.
        
    - **Соответствует**: Таблицы измерений и фактов в более-менее нормализованном виде.
        
- **Gold (Золотой слой)**
    
    - **Что это?** Агрегированные данные, готовые для бизнес-потребления. Это "витрины данных" для конкретных задач.
        
    - **Примеры**: Агрегаты по продажам за месяц, готовые наборы данных (фичи) для моделей машинного обучения.
        
    - **Соответствует**: Денормализованные витрины для BI и аналитики.
        

---

### Сравнение трех архитектур

|   |   |   |   |
|---|---|---|---|
|Характеристика|Data Lake|Data Warehouse|Lakehouse|
|**Типы данных**|Все (структурированные, неструктурированные)|Только структурированные|Все|
|**Схема**|Schema-on-Read|Schema-on-Write|Гибрид, обеспечивается на уровне таблиц|
|**Надежность**|Низкая (риск "болота")|Высокая (ACID)|**Высокая (ACID поверх озера)**|
|**Основной сценарий**|Data Science, ML, хранение сырых данных|BI, отчетность|**Единая платформа для BI, DS, ML, ETL**|
|**Ключевая технология**|HDFS, S3|Teradata, Snowflake, BigQuery|**Delta Lake/Iceberg + Spark поверх S3**|

---

### Популярные вопросы на собеседовании

- **"Что такое архитектура Lakehouse и какую проблему она решает?"**
    
- **"Какие ключевые технологии делают Lakehouse возможным?"**
    
    - Ответ: Во-первых, дешевое облачное хранилище. Во-вторых, и это главное, — форматы таблиц с транзакционной поддержкой, такие как **Delta Lake** или **Apache Iceberg**, которые привносят ACID-гарантии в озеро данных.
        
- **"Расскажите про 'Медальонную архитектуру'."**
    
    - Ответ: Это способ организации данных в Lakehouse, состоящий из трех слоев: Bronze (сырые данные), Silver (очищенные и обогащенные) и Gold (агрегированные витрины для бизнеса).
        
- **"Как Lakehouse связан с Apache Spark?"**
    
    - Ответ: Spark является основным вычислительным движком для Lakehouse. Он идеально интегрирован с форматами вроде Delta Lake для чтения и записи данных, а также для выполнения всех трансформаций.