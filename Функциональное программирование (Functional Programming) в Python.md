tags: [python, core-python, programming, interviewprep, functional-programming, fp]  
alias: [Функциональное программирование, ФП, Pure Functions, Immutability, map, filter, reduce]  
related: [[Python]], [[Итераторы (Iterators)]], [[Генераторы и итераторы в Python]], [[Декораторы (Decorators)]]

**Функциональное программирование (ФП)** — это парадигма программирования, в которой основной строительный блок программы — это **функции**. Процесс вычисления рассматривается как оценка математических функций, при этом стараются избегать изменения состояния и изменяемых данных.

> **Основная идея**: Вместо того чтобы говорить компьютеру, **как** что-то сделать (императивный подход), мы описываем, **что** мы хотим получить (декларативный подход), составляя цепочки из функций.

Python — это мультипарадигменный язык, он не заставляет вас писать в функциональном стиле, но предоставляет для этого все необходимые инструменты.

---

### Ключевые принципы ФП

1. **Чистые функции (Pure Functions)**  
    Это фундамент ФП. Функция является "чистой", если она удовлетворяет двум условиям:
    
    - **Детерминизм**: Для одних и тех же входных данных она **всегда** возвращает один и тот же результат.
        
    - **Отсутствие побочных эффектов (Side Effects)**: Функция не изменяет никаких данных вне своей области видимости (не меняет глобальные переменные, не пишет в файл, не печатает в консоль, не меняет свои аргументы, если они изменяемы).
    
    ```python
    # Чистая функция
def add(a, b):
    return a + b

# Нечистая функция (имеет побочный эффект - изменяет глобальную переменную)
total = 0
def add_to_total(x):
    global total
    total += x
    return total
```

1. Преимущество чистых функций: их легко тестировать, анализировать и распараллеливать.
    
2. **Неизменяемость (Immutability)**  
    Данные считаются неизменяемыми, если их состояние нельзя изменить после создания. Вместо изменения существующих данных создаются новые. В Python примерами неизменяемых типов являются tuple, str, int, frozenset.  
    В ФП предпочитают tuple вместо list.
    
3. **Функции как объекты первого класса**  
    Мы это уже обсуждали в теме [[Декораторы (Decorators)]]. Функции можно передавать как аргументы и возвращать как результаты, что позволяет создавать функции высшего порядка.
    

---

### Инструменты ФП в Python

#### 1. lambda-функции (Анонимные функции)

Это маленькие, однострочные функции без имени. Они полезны, когда вам нужна простая функция на короткое время, например, в качестве аргумента для map или filter.

**Синтаксис**: lambda arguments: expression

```python
# Обычная функция
def power(x):
    return x * x

# Эквивалентная lambda-функция
power_lambda = lambda x: x * x

print(power_lambda(5)) # -> 25
```

#### 2. map()

map(function, iterable) — применяет function к каждому элементу iterable и возвращает **итератор** с результатами.

```python
numbers = [1, 2, 3, 4]

# Увеличить каждый элемент на 1
# map() возвращает итератор, поэтому мы оборачиваем его в list для просмотра
incremented = list(map(lambda x: x + 1, numbers))
print(incremented) # -> [2, 3, 4, 5]

# Это ленивая операция, что эффективно по памяти.
```

Современная альтернатива в Python — списковые включения или выражения-генераторы, которые часто считаются более читаемыми:  
incremented_lc = [x + 1 for x in numbers]

#### 3. filter()

filter(function, iterable) — проверяет каждый элемент iterable с помощью function. Если функция возвращает True, элемент остается. Возвращает **итератор**.

```python
numbers = [1, 2, 3, 4, 5, 6]

# Оставить только четные числа
even_numbers = list(filter(lambda x: x % 2 == 0, numbers))
print(even_numbers) # -> [2, 4, 6]
```

Альтернатива в виде спискового включения:  
even_numbers_lc = [x for x in numbers if x % 2 == 0]

#### 4. functools.reduce()

reduce(function, iterable) — последовательно применяет "сворачивающую" функцию к элементам последовательности, чтобы свести ее к одному значению. function должна принимать два аргумента.

> **Важно**: reduce была вынесена из встроенных функций в модуль functools, так как ее чрезмерное использование может ухудшать читаемость кода.

```python
from functools import reduce

numbers = [1, 2, 3, 4]

# Найти сумму всех элементов
# ((1+2)+3)+4
total = reduce(lambda acc, item: acc + item, numbers)
print(total) # -> 10

# Для этой задачи, конечно, лучше использовать встроенную sum()
```


### Преимущества и недостатки ФП в Python

**(+) Плюсы:**

- **Читаемость и предсказуемость**: Чистые функции легче для понимания, так как их результат зависит только от аргументов.
    
- **Простота тестирования**: Чистые функции легко тестировать — не нужно создавать сложный "контекст" или "мок-объекты".
    
- **Потокобезопасность**: Код, основанный на неизменяемых данных и чистых функциях, легче распараллеливать, так как нет общих изменяемых состояний и гонок данных.
    

**(-) Минусы:**

- **Производительность**: Создание новых объектов вместо изменения старых может приводить к большему потреблению памяти и нагрузке на сборщик мусора.
    
- **Не всегда идиоматично**: Python — не чисто функциональный язык. Иногда императивный код с циклами for может быть проще для понимания, чем сложные цепочки из map, filter и reduce.
    

---

### Популярные вопросы на собеседовании

- **"Что такое чистая функция? Приведите пример."**
    
- **"В чем разница между map и filter?"**
    
    - Ответ: map применяет функцию ко всем элементам и возвращает итератор с результатами той же длины. filter использует функцию-предикат для отбора элементов и возвращает итертор только с теми элементами, которые прошли проверку.
        
- **"Когда вы предпочтете списковое включение вместо map и filter?"**
    
    - Ответ: В большинстве простых случаев списковые включения ([x*2 for x in numbers if x > 0]) в Python считаются более читаемыми и идиоматичными, чем комбинация map и filter. Я бы использовал map/filter, если у меня уже есть готовая, сложная именованная функция, которую нужно применить.
        
- **"Что такое lambda и в чем ее ограничения?"**
    
    - Ответ: Это анонимная функция, ограниченная одним выражением. Она не может содержать инструкции (if, for, while) или return.